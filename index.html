<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Preventivi Fattoria di Nonno Tot√≤</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #3d5a3d 0%, #5a7c5a 50%, #b8860b 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .logo {
            width: 120px;
            height: 120px;
            margin: 0 auto 20px;
            background: linear-gradient(135deg, #3d5a3d 0%, #b8860b 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: bold;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            border: 3px solid #b8860b;
        }
        
        h1 {
            color: #3d5a3d;
            font-size: 2.5em;
        }
        
        .form-section {
            background: rgba(245, 245, 245, 0.5);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            border-left: 5px solid #3d5a3d;
        }
        
        .form-section h3 {
            color: #3d5a3d;
            margin-bottom: 20px;
            font-size: 1.3em;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #3d5a3d;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #3d5a3d;
            box-shadow: 0 0 10px rgba(61, 90, 61, 0.3);
        }
        
        .counter-group {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .counter {
            display: flex;
            align-items: center;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px solid #ddd;
        }
        
        .counter button {
            background: #3d5a3d;
            color: white;
            border: none;
            padding: 10px 15px;
            cursor: pointer;
            font-size: 18px;
        }
        
        .counter button:hover {
            background: #2d4a2d;
        }
        
        .counter input {
            border: none;
            text-align: center;
            width: 60px;
            padding: 10px 5px;
            background: #f8f9fa;
        }
        
        .menu-selection {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .menu-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #ddd;
        }
        
        .menu-card h4 {
            color: #3d5a3d;
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        
        .menu-option {
            margin-bottom: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            cursor: pointer;
        }
        
        .menu-option input {
            width: auto;
            margin-right: 10px;
        }
        
        .checkbox-group {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #f8f9fa;
            padding: 10px 15px;
            border-radius: 10px;
            border: 2px solid #e9ecef;
            cursor: pointer;
        }
        
        .checkbox-item input {
            width: auto;
        }
        
        .btn {
            background: linear-gradient(45deg, #3d5a3d, #b8860b);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            cursor: pointer;
            width: 100%;
            margin: 20px 0;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }

        .numero-preventivo {
            background: linear-gradient(45deg, #3d5a3d, #b8860b);
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            display: inline-block;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .preventivo {
            background: linear-gradient(135deg, #3d5a3d 0%, #b8860b 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-top: 30px;
        }
        
        .preventivo h2 {
            text-align: center;
            margin-bottom: 20px;
            font-size: 2em;
        }
        
        .dettagli {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .voce-preventivo {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.3);
        }
        
        .totale {
            font-size: 1.5em;
            font-weight: bold;
            text-align: center;
            margin-top: 20px;
            padding: 15px;
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
        }

        .stampa-btn {
            background: linear-gradient(45deg, #17a2b8, #138496);
            margin-top: 20px;
        }

        @media print {
            body {
                background: white !important;
                font-size: 12px;
            }
            .container {
                box-shadow: none;
                margin: 0;
                padding: 20px;
                background: white !important;
            }
            .form-section, .btn, .btn-group, form {
                display: none !important;
            }
            .preventivo {
                background: white !important;
                color: black !important;
                box-shadow: none;
                margin: 0;
                padding: 0;
            }
            .dettagli {
                background: white !important;
                border: 1px solid #ddd;
                color: black !important;
            }
            .voce-preventivo {
                border-bottom: 1px solid #ddd !important;
            }
            .numero-preventivo {
                background: #3d5a3d !important;
                color: white !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            .totale {
                background: #f8f9fa !important;
                color: black !important;
                border: 2px solid #3d5a3d;
            }
            .header {
                display: none !important;
            }
        }

        @media (max-width: 768px) {
            .form-row, .menu-selection {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">üå≥üöú<br>Fattoria<br>Nonno Tot√≤</div>
            <h1>Sistema Preventivi</h1>
        </div>
        
        <form id="preventivoForm">
            <!-- Dati Cliente -->
            <div class="form-section">
                <h3>üë§ Dati Cliente</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="nome">Nome *:</label>
                        <input type="text" id="nome" required>
                    </div>
                    <div class="form-group">
                        <label for="cognome">Cognome *:</label>
                        <input type="text" id="cognome" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="dataNascita">Data di Nascita *:</label>
                        <input type="date" id="dataNascita" required>
                    </div>
                    <div class="form-group">
                        <label for="telefono">Telefono:</label>
                        <input type="tel" id="telefono">
                    </div>
                </div>
                <div class="form-group">
                    <label for="email">Email:</label>
                    <input type="email" id="email">
                </div>
            </div>

            <!-- Informazioni Evento -->
            <div class="form-section">
                <h3>üìÖ Informazioni Evento</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="data">Data Evento:</label>
                        <input type="date" id="data" required>
                    </div>
                    <div class="form-group">
                        <label for="ora">Ora Evento:</label>
                        <input type="time" id="ora" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="spazio">Spazio Richiesto:</label>
                    <select id="spazio" required>
                        <option value="">Seleziona spazio</option>
                        <option value="sala1">Sala Interna 1 (40 posti)</option>
                        <option value="sala2">Sala Interna 2 (70 posti)</option>
                        <option value="esterno">Spazio Esterno (200 posti)</option>
                        <option value="sale">Entrambe le Sale (110 posti)</option>
                        <option value="tutto">Tutto l'Agriturismo (200 posti)</option>
                    </select>
                </div>
            </div>

            <!-- Numero Partecipanti -->
            <div class="form-section">
                <h3>üë• Numero Partecipanti</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Adulti:</label>
                        <div class="counter-group">
                            <div class="counter">
                                <button type="button" onclick="changeCount('adulti', -1)">-</button>
                                <input type="number" id="adulti" min="0" max="200" value="20" readonly>
                                <button type="button" onclick="changeCount('adulti', 1)">+</button>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Bambini:</label>
                        <div class="counter-group">
                            <div class="counter">
                                <button type="button" onclick="changeCount('bambini', -1)">-</button>
                                <input type="number" id="bambini" min="0" max="50" value="0" readonly>
                                <button type="button" onclick="changeCount('bambini', 1)">+</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <div style="text-align: center; padding: 10px; background: #e8f4f8; border-radius: 8px;">
                        <strong>Totale Ospiti: <span id="totaleOspiti">20</span></strong>
                    </div>
                </div>
            </div>

            <!-- Menu Selection -->
            <div class="form-section">
                <h3>üçΩÔ∏è Selezione Menu</h3>
                <div class="menu-selection">
                    <div class="menu-card">
                        <h4>Menu Adulti</h4>
                        <div class="menu-option">
                            <input type="radio" name="menuAdulti" value="rosticceria" id="adulti-rosticceria">
                            <label for="adulti-rosticceria">Rosticceria<br><small>500g di porzione</small></label>
                            <div style="margin-top: 10px; display: flex; align-items: center; gap: 10px;">
                                <span>Prezzo: ‚Ç¨</span>
                                <input type="number" id="prezzoRosticceria" value="14" min="0" step="0.01" style="width: 80px; padding: 5px;">
                            </div>
                        </div>
                        <div class="menu-option">
                            <input type="radio" name="menuAdulti" value="bbq" id="adulti-bbq">
                            <label for="adulti-bbq">American BBQ<br><small>Ali, ribs, pulled pork, pannocchia, salsiccia</small></label>
                            <div style="margin-top: 10px; display: flex; align-items: center; gap: 10px;">
                                <span>Prezzo: ‚Ç¨</span>
                                <input type="number" id="prezzoBbq" value="40" min="0" step="0.01" style="width: 80px; padding: 5px;">
                            </div>
                        </div>
                        <div class="menu-option">
                            <input type="radio" name="menuAdulti" value="pizza" id="adulti-pizza">
                            <label for="adulti-pizza">Menu Pizza<br><small>Pizza 3 gusti + friggitoria</small></label>
                            <div style="margin-top: 10px; display: flex; align-items: center; gap: 10px;">
                                <span>Prezzo: ‚Ç¨</span>
                                <input type="number" id="prezzoPizza" value="25" min="0" step="0.01" style="width: 80px; padding: 5px;">
                            </div>
                        </div>
                    </div>

                    <div class="menu-card">
                        <h4>Menu Bambini</h4>
                        <div class="menu-option">
                            <input type="radio" name="menuBambini" value="pasta" id="bambini-pasta">
                            <label for="bambini-pasta">Pasta & Polpette<br><small>Pennette al sugo + polpette/nuggets</small></label>
                            <div style="margin-top: 10px; display: flex; align-items: center; gap: 10px;">
                                <span>Prezzo: ‚Ç¨</span>
                                <input type="number" id="prezzoPasta" value="7.99" min="0" step="0.01" style="width: 80px; padding: 5px;">
                            </div>
                        </div>
                        <div class="menu-option">
                            <input type="radio" name="menuBambini" value="panino" id="bambini-panino">
                            <label for="bambini-panino">Panino & Pizza<br><small>Panino prosciutto + pizzetta + patatine</small></label>
                            <div style="margin-top: 10px; display: flex; align-items: center; gap: 10px;">
                                <span>Prezzo: ‚Ç¨</span>
                                <input type="number" id="prezzoPanino" value="7.99" min="0" step="0.01" style="width: 80px; padding: 5px;">
                            </div>
                        </div>
                        <div class="menu-option">
                            <input type="radio" name="menuBambini" value="no-menu" id="bambini-no">
                            <label for="bambini-no">Nessun menu bambini</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Postazioni Street Food -->
            <div class="form-section">
                <h3>üçï Postazioni Street Food</h3>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="streetPizza">
                        <label for="streetPizza">Pizza 2 Gusti - ‚Ç¨500 (fino a 50 persone)</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="streetSpritz">
                        <label for="streetSpritz">Spritz - ‚Ç¨300 (fino a 50 persone)</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="streetBbq">
                        <label for="streetBbq">American BBQ - ‚Ç¨500 (fino a 50 persone)</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="streetFriggitoria">
                        <label for="streetFriggitoria">Friggitoria Napoletana - ‚Ç¨350 (fino a 50 persone)</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="streetGraffe">
                        <label for="streetGraffe">Graffe - ‚Ç¨250 (fino a 50 persone)</label>
                    </div>
                </div>
                <div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; padding: 15px; margin-top: 15px;">
                    <small><strong>‚ö†Ô∏è Nota:</strong> Prezzi base fino a 50 persone. Ogni 10 persone aggiuntive: +‚Ç¨100</small>
                </div>
            </div>

            <!-- Servizi Aggiuntivi -->
            <div class="form-section">
                <h3>üéâ Servizi Aggiuntivi</h3>
                
                <!-- Animazione Base -->
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="animazione">
                        <label for="animazione">Animazione Base - ‚Ç¨150</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="allestimento">
                        <label for="allestimento">Allestimento Base - ‚Ç¨150</label>
                    </div>
                </div>

                <!-- Servizi Animazione Extra -->
                <div style="margin-top: 20px;">
                    <h4 style="color: #3d5a3d; margin-bottom: 15px;">üé≠ Servizi Animazione Extra</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="extraAnimatori">Extra Animatori:</label>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <input type="checkbox" id="extraAnimatori" style="width: auto;">
                                <input type="number" id="prezzoAnimatori" placeholder="Prezzo ‚Ç¨" min="0" style="flex: 1;">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="gonfiabili">Gonfiabili:</label>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <input type="checkbox" id="gonfiabili" style="width: auto;">
                                <input type="number" id="prezzoGonfiabili" placeholder="Prezzo ‚Ç¨" min="0" style="flex: 1;">
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="scenografie">Scenografie:</label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="checkbox" id="scenografie" style="width: auto;">
                            <input type="number" id="prezzoScenografie" placeholder="Prezzo ‚Ç¨" min="0" style="flex: 1;">
                        </div>
                    </div>
                </div>
                
                <div class="form-group" style="margin-top: 20px;">
                    <label for="altriServizi">Altri Servizi Personalizzati:</label>
                    <textarea id="altriServizi" placeholder="Descrivi altri servizi richiesti (DJ, fotografo, decorazioni speciali, ecc.)"></textarea>
                </div>

                <!-- Richieste Personalizzate con Prezzo -->
                <div style="margin-top: 25px;">
                    <h4 style="color: #3d5a3d; margin-bottom: 15px;">üí∞ Richieste Personalizzate con Prezzo</h4>
                    <div id="richiesteContainer">
                        <div class="richiesta-item" style="background: white; padding: 15px; border-radius: 10px; border: 2px solid #e9ecef; margin-bottom: 10px;">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Descrizione Servizio:</label>
                                    <input type="text" class="richiesta-desc" placeholder="es. DJ per 4 ore, Fotografo, Decorazioni speciali...">
                                </div>
                                <div class="form-group">
                                    <label>Prezzo ‚Ç¨:</label>
                                    <input type="number" class="richiesta-prezzo" placeholder="0" min="0">
                                </div>
                            </div>
                            <button type="button" onclick="rimuoviRichiesta(this)" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 5px; font-size: 12px; cursor: pointer;">Rimuovi</button>
                        </div>
                    </div>
                    <button type="button" onclick="aggiungiRichiesta()" style="background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; margin-top: 10px;">+ Aggiungi Altra Richiesta</button>
                </div>
            </div>

            <!-- Note -->
            <div class="form-section">
                <h3>üìù Note Aggiuntive</h3>
                <div class="form-group">
                    <label for="note">Richieste Speciali:</label>
                    <textarea id="note" placeholder="Inserisci eventuali richieste speciali"></textarea>
                </div>
            </div>
            
            <button type="submit" class="btn">Genera Preventivo</button>
        </form>
        
        <div id="risultato"></div>
    </div>

    <script>
        // Funzioni per gestire richieste dinamiche
        function aggiungiRichiesta() {
            var container = document.getElementById('richiesteContainer');
            var nuovaRichiesta = document.createElement('div');
            nuovaRichiesta.className = 'richiesta-item';
            nuovaRichiesta.style = 'background: white; padding: 15px; border-radius: 10px; border: 2px solid #e9ecef; margin-bottom: 10px;';
            nuovaRichiesta.innerHTML = 
                '<div class="form-row">' +
                    '<div class="form-group">' +
                        '<label>Descrizione Servizio:</label>' +
                        '<input type="text" class="richiesta-desc" placeholder="es. DJ per 4 ore, Fotografo, Decorazioni speciali...">' +
                    '</div>' +
                    '<div class="form-group">' +
                        '<label>Prezzo ‚Ç¨:</label>' +
                        '<input type="number" class="richiesta-prezzo" placeholder="0" min="0">' +
                    '</div>' +
                '</div>' +
                '<button type="button" onclick="rimuoviRichiesta(this)" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 5px; font-size: 12px; cursor: pointer;">Rimuovi</button>';
            container.appendChild(nuovaRichiesta);
        }

        function rimuoviRichiesta(button) {
            var richiesteItems = document.querySelectorAll('.richiesta-item');
            if (richiesteItems.length > 1) {
                button.parentElement.remove();
            } else {
                alert('Deve rimanere almeno una richiesta. Puoi lasciarla vuota se non hai richieste.');
            }
        }

        function getRichiestePersonalizzate() {
            var richieste = [];
            var items = document.querySelectorAll('.richiesta-item');
            
            items.forEach(function(item) {
                var desc = item.querySelector('.richiesta-desc').value.trim();
                var prezzo = parseFloat(item.querySelector('.richiesta-prezzo').value) || 0;
                
                if (desc && prezzo > 0) {
                    richieste.push({
                        descrizione: desc,
                        prezzo: prezzo
                    });
                }
            });
            
            return richieste;
        }

        function generaNumeroPreventivo() {
            var oggi = new Date();
            var anno = oggi.getFullYear();
            var mese = String(oggi.getMonth() + 1).padStart(2, '0');
            var giorno = String(oggi.getDate()).padStart(2, '0');
            
            var contatore = localStorage.getItem('contatore_preventivi_' + anno + mese + giorno) || 1;
            var numeroPreventivo = 'FNT-' + anno + mese + giorno + '-' + String(contatore).padStart(3, '0');
            
            localStorage.setItem('contatore_preventivi_' + anno + mese + giorno, parseInt(contatore) + 1);
            
            return numeroPreventivo;
        }

        function stampaPDF() {
            window.print();
        }

        function changeCount(tipo, delta) {
            var input = document.getElementById(tipo);
            var currentValue = parseInt(input.value) || 0;
            var newValue = Math.max(0, currentValue + delta);
            
            if (tipo === 'adulti' && newValue > 200) return;
            if (tipo === 'bambini' && newValue > 50) return;
            
            input.value = newValue;
            updateTotaleOspiti();
        }

        function updateTotaleOspiti() {
            var adulti = parseInt(document.getElementById('adulti').value) || 0;
            var bambini = parseInt(document.getElementById('bambini').value) || 0;
            var totale = adulti + bambini;
            document.getElementById('totaleOspiti').textContent = totale;
        }

        document.getElementById('preventivoForm').addEventListener('submit', function(e) {
            e.preventDefault();
            generaPreventivo();
        });

        function generaPreventivo() {
            var nome = document.getElementById('nome').value.trim();
            var cognome = document.getElementById('cognome').value.trim();
            var dataNascita = document.getElementById('dataNascita').value;
            var telefono = document.getElementById('telefono').value.trim();
            var email = document.getElementById('email').value.trim();
            var data = document.getElementById('data').value;
            var ora = document.getElementById('ora').value;
            var adulti = parseInt(document.getElementById('adulti').value) || 0;
            var bambini = parseInt(document.getElementById('bambini').value) || 0;
            var spazio = document.getElementById('spazio').value;
            var menuAdulti = document.querySelector('input[name="menuAdulti"]:checked');
            var menuBambini = document.querySelector('input[name="menuBambini"]:checked');
            var animazione = document.getElementById('animazione').checked;
            var allestimento = document.getElementById('allestimento').checked;
            var streetPizza = document.getElementById('streetPizza').checked;
            var streetSpritz = document.getElementById('streetSpritz').checked;
            var streetBbq = document.getElementById('streetBbq').checked;
            var streetFriggitoria = document.getElementById('streetFriggitoria').checked;
            var streetGraffe = document.getElementById('streetGraffe').checked;
            
            var extraAnimatori = document.getElementById('extraAnimatori').checked;
            var prezzoAnimatori = parseInt(document.getElementById('prezzoAnimatori').value) || 0;
            var gonfiabili = document.getElementById('gonfiabili').checked;
            var prezzoGonfiabili = parseInt(document.getElementById('prezzoGonfiabili').value) || 0;
            var scenografie = document.getElementById('scenografie').checked;
            var prezzoScenografie = parseInt(document.getElementById('prezzoScenografie').value) || 0;
            
            var altriServizi = document.getElementById('altriServizi').value;
            var note = document.getElementById('note').value;

            // Ottieni richieste personalizzate
            var richiestePersonalizzate = getRichiestePersonalizzate();

            var totaleOspiti = adulti + bambini;

            // Validazioni
            if (!nome || !cognome || !dataNascita) {
                alert('Inserisci nome, cognome e data di nascita');
                return;
            }

            if (!data || !ora) {
                alert('Inserisci data e ora dell evento');
                return;
            }

            if (adulti === 0 && bambini === 0) {
                alert('Inserisci almeno un partecipante');
                return;
            }

            if (adulti > 0 && !menuAdulti) {
                alert('Seleziona un menu per gli adulti');
                return;
            }

            if (bambini > 0 && !menuBambini) {
                alert('Seleziona un opzione per i bambini');
                return;
            }

            if (extraAnimatori && prezzoAnimatori === 0) {
                alert('Inserisci il prezzo per Extra Animatori');
                return;
            }
            if (gonfiabili && prezzoGonfiabili === 0) {
                alert('Inserisci il prezzo per Gonfiabili');
                return;
            }
            if (scenografie && prezzoScenografie === 0) {
                alert('Inserisci il prezzo per Scenografie');
                return;
            }

            var capacita = {
                'sala1': 40,
                'sala2': 70,
                'esterno': 200,
                'sale': 110,
                'tutto': 200
            };

            if (totaleOspiti > capacita[spazio]) {
                alert('Il numero totale di ospiti supera la capacit√† dello spazio selezionato');
                return;
            }

            var numeroPreventivo = generaNumeroPreventivo();

            var oggi = new Date();
            var nascita = new Date(dataNascita);
            var eta = oggi.getFullYear() - nascita.getFullYear();
            var meseCorrente = oggi.getMonth();
            var giornoCorrente = oggi.getDate();
            if (meseCorrente < nascita.getMonth() || (meseCorrente === nascita.getMonth() && giornoCorrente < nascita.getDate())) {
                eta--;
            }

            var costoAdulti = 0;
            var costoBambini = 0;
            var nomeMenuAdulti = '';
            var nomeMenuBambini = '';
            
            if (adulti > 0 && menuAdulti) {
                switch(menuAdulti.value) {
                    case 'rosticceria':
                        costoAdulti = adulti * 14;
                        nomeMenuAdulti = 'Menu Rosticceria (500g/persona)';
                        break;
                    case 'bbq':
                        costoAdulti = adulti * 40;
                        nomeMenuAdulti = 'American BBQ Completo';
                        break;
                    case 'pizza':
                        costoAdulti = adulti * 25;
                        nomeMenuAdulti = 'Menu Pizza + Friggitoria';
                        break;
                }
            }

            if (bambini > 0 && menuBambini && menuBambini.value !== 'no-menu') {
                costoBambini = bambini * 7.99;
                switch(menuBambini.value) {
                    case 'pasta':
                        nomeMenuBambini = 'Menu Bambini - Pasta & Polpette';
                        break;
                    case 'panino':
                        nomeMenuBambini = 'Menu Bambini - Panino & Pizza';
                        break;
                }
            }

            function calcolaStreetFood(prezzo, nome) {
                if (totaleOspiti <= 50) {
                    return { costo: prezzo, descrizione: nome + ' (fino a 50 persone)' };
                } else {
                    var maggiorazione = Math.ceil((totaleOspiti - 50) / 10) * 100;
                    return { 
                        costo: prezzo + maggiorazione, 
                        descrizione: nome + ' (' + totaleOspiti + ' persone: base ‚Ç¨' + prezzo + ' + maggiorazione ‚Ç¨' + maggiorazione + ')'
                    };
                }
            }

            var costoAnimazione = animazione ? 150 : 0;
            var costoAllestimento = allestimento ? 150 : 0;
            var costoExtraAnimatori = extraAnimatori ? prezzoAnimatori : 0;
            var costoGonfiabili = gonfiabili ? prezzoGonfiabili : 0;
            var costoScenografie = scenografie ? prezzoScenografie : 0;

            // Calcola costo richieste personalizzate
            var costoRichiestePersonalizzate = 0;
            richiestePersonalizzate.forEach(function(richiesta) {
                costoRichiestePersonalizzate += richiesta.prezzo;
            });

            var streetFoodItems = [];
            var costoStreetFood = 0;
            
            if (streetPizza) {
                var pizza = calcolaStreetFood(500, 'Postazione Pizza');
                streetFoodItems.push(pizza);
                costoStreetFood += pizza.costo;
            }
            if (streetSpritz) {
                var spritz = calcolaStreetFood(300, 'Postazione Spritz');
                streetFoodItems.push(spritz);
                costoStreetFood += spritz.costo;
            }
            if (streetBbq) {
                var bbq = calcolaStreetFood(500, 'Postazione American BBQ');
                streetFoodItems.push(bbq);
                costoStreetFood += bbq.costo;
            }
            if (streetFriggitoria) {
                var friggitoria = calcolaStreetFood(350, 'Postazione Friggitoria Napoletana');
                streetFoodItems.push(friggitoria);
                costoStreetFood += friggitoria.costo;
            }
            if (streetGraffe) {
                var graffe = calcolaStreetFood(250, 'Postazione Graffe');
                streetFoodItems.push(graffe);
                costoStreetFood += graffe.costo;
            }
            
            var costoMenu = costoAdulti + costoBambini;
            var costoServiziExtra = costoExtraAnimatori + costoGonfiabili + costoScenografie;
            var totale = costoMenu + costoAnimazione + costoAllestimento + costoStreetFood + costoServiziExtra + costoRichiestePersonalizzate;
            var anticipo = Math.round(totale * 0.3);

            var nomiSpazi = {
                'sala1': 'Sala Interna 1 (40 posti)',
                'sala2': 'Sala Interna 2 (70 posti)', 
                'esterno': 'Spazio Esterno (200 posti)',
                'sale': 'Entrambe le Sale Interne (110 posti)',
                'tutto': 'Tutto l\'Agriturismo (200 posti)'
            };

            var dataFormattata = new Date(data).toLocaleDateString('it-IT', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });

            var preventivoHTML = '<div class="preventivo">' +
                '<div class="numero-preventivo">Preventivo N¬∞: ' + numeroPreventivo + '</div>' +
                '<h2>üìã Preventivo Evento</h2>' +
                '<div class="dettagli">' +
                    '<h3>üë§ Dati Cliente</h3>' +
                    '<div class="voce-preventivo"><span>Cliente:</span><span>' + nome + ' ' + cognome + '</span></div>' +
                    '<div class="voce-preventivo"><span>Data di Nascita:</span><span>' + new Date(dataNascita).toLocaleDateString('it-IT') + ' (' + eta + ' anni)</span></div>' +
                    (telefono ? '<div class="voce-preventivo"><span>Telefono:</span><span>' + telefono + '</span></div>' : '') +
                    (email ? '<div class="voce-preventivo"><span>Email:</span><span>' + email + '</span></div>' : '') +
                '</div>' +
                '<div class="dettagli">' +
                    '<h3>üìÖ Dettagli Evento</h3>' +
                    '<div class="voce-preventivo"><span>Data e Ora:</span><span>' + dataFormattata + ' ore ' + ora + '</span></div>' +
                    '<div class="voce-preventivo"><span>Partecipanti:</span><span>' + adulti + ' adulti' + (bambini > 0 ? ' + ' + bambini + ' bambini' : '') + ' (Totale: ' + totaleOspiti + ')</span></div>' +
                    '<div class="voce-preventivo"><span>Spazio:</span><span>' + nomiSpazi[spazio] + '</span></div>' +
                '</div>';

            if (costoMenu > 0) {
                preventivoHTML += '<div class="dettagli">' +
                    '<h3>üçΩÔ∏è Menu Selezionati</h3>' +
                    (adulti > 0 ? '<div class="voce-preventivo"><span>' + nomeMenuAdulti + ' (x' + adulti + ')</span><span>‚Ç¨' + costoAdulti.toFixed(2) + '</span></div>' : '') +
                    (bambini > 0 && menuBambini && menuBambini.value !== 'no-menu' ? '<div class="voce-preventivo"><span>' + nomeMenuBambini + ' (x' + bambini + ')</span><span>‚Ç¨' + costoBambini.toFixed(2) + '</span></div>' : '') +
                    (bambini > 0 && menuBambini && menuBambini.value === 'no-menu' ? '<div class="voce-preventivo"><span>Bambini senza menu (x' + bambini + ')</span><span>‚Ç¨0.00</span></div>' : '') +
                '</div>';
            }

            preventivoHTML += '<div class="dettagli">' +
                '<h3>üí∞ Riepilogo Costi</h3>' +
                (costoMenu > 0 ? '<div class="voce-preventivo"><span>Totale Menu</span><span>‚Ç¨' + costoMenu.toFixed(2) + '</span></div>' : '');

            for (var i = 0; i < streetFoodItems.length; i++) {
                var item = streetFoodItems[i];
                preventivoHTML += '<div class="voce-preventivo"><span>' + item.descrizione + '</span><span>‚Ç¨' + item.costo.toFixed(2) + '</span></div>';
            }

            preventivoHTML += (animazione ? '<div class="voce-preventivo"><span>Animazione Base</span><span>‚Ç¨150.00</span></div>' : '') +
                (allestimento ? '<div class="voce-preventivo"><span>Allestimento Base</span><span>‚Ç¨150.00</span></div>' : '') +
                (extraAnimatori ? '<div class="voce-preventivo"><span>Extra Animatori</span><span>‚Ç¨' + prezzoAnimatori.toFixed(2) + '</span></div>' : '') +
                (gonfiabili ? '<div class="voce-preventivo"><span>Gonfiabili</span><span>‚Ç¨' + prezzoGonfiabili.toFixed(2) + '</span></div>' : '') +
                (scenografie ? '<div class="voce-preventivo"><span>Scenografie</span><span>‚Ç¨' + prezzoScenografie.toFixed(2) + '</span></div>' : '');

            // Aggiungi richieste personalizzate al preventivo
            richiestePersonalizzate.forEach(function(richiesta) {
                preventivoHTML += '<div class="voce-preventivo"><span>' + richiesta.descrizione + '</span><span>‚Ç¨' + richiesta.prezzo.toFixed(2) + '</span></div>';
            });

            preventivoHTML += '<div class="totale"><strong>TOTALE: ‚Ç¨' + totale.toFixed(2) + '</strong></div>' +
                '<div style="text-align: center; margin-top: 15px;"><strong>Anticipo richiesto (30%): ‚Ç¨' + anticipo.toFixed(2) + '</strong></div>' +
            '</div>' +
            '<div class="dettagli">' +
                '<h3>‚úÖ Servizi Inclusi</h3>' +
                '<p>‚Ä¢ Tavoli, sedie, tovagliato e stoviglie monouso<br>' +
                '‚Ä¢ Parcheggio gratuito<br>' +
                '‚Ä¢ Uso bagni e riscaldamento<br>' +
                '‚Ä¢ Bevande analcoliche incluse<br>' +
                '‚Ä¢ Servizio di sala</p>' +
            '</div>' +
            (altriServizi ? '<div class="dettagli"><h3>üé≠ Altri Servizi Richiesti:</h3><p>' + altriServizi + '</p></div>' : '') +
            (note ? '<div class="dettagli"><h3>üìù Note:</h3><p>' + note + '</p></div>' : '') +
            '<div class="dettagli" style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px; margin-top: 20px; font-size: 14px;">' +
                '<h3>üìã Condizioni di Prenotazione</h3>' +
                '<p><strong>Anticipo:</strong> 30% del totale (‚Ç¨' + anticipo.toFixed(2) + ')<br>' +
                '<strong>Cancellazione:</strong><br>' +
                '‚Ä¢ Fino a 7 giorni prima: si perde l\'anticipo<br>' +
                '‚Ä¢ Da 6 giorni prima: va versato il 50% dell\'evento (‚Ç¨' + (totale * 0.5).toFixed(2) + ')<br>' +
                '<strong>Bevande alcoliche:</strong> A pagamento a parte<br>' +
                '<strong>Saldo:</strong> Il giorno dell\'evento</p>' +
            '</div>' +
            '<button class="btn stampa-btn" onclick="stampaPDF()">üñ®Ô∏è Stampa Preventivo</button>' +
        '</div>';

            document.getElementById('risultato').innerHTML = preventivoHTML;
        }

        updateTotaleOspiti();
    </script>
</body>
</html>
